<tool id="rename_tiff_channels" name="Rename OME-TIFF Channels" version="@VERSION@.2" profile="19.01">
    <description>A simple script to change the channel names in the XML metadata of OME-TIFF images</description>
    <macros>
        <import>macros.xml</import>
    </macros>
 
    <expand macro="requirements"/>
    <expand macro="version_cmd"/>

    <command detect_errors="exit_code"><![CDATA[
        cp '$image' '$renamed_image' && 
        @CMD_BEGIN@ '$image' '$channel_csv' out.xml &&
        tiffcomment -set out.xml '$renamed_image'
    ]]></command>

    <inputs>
        <param name="image" type="data" format="tiff" label="Input image in either tiff or OME-tiff format"/>
        <param name="input_type" type="select" optional="false" label="Format of input image">
            <option value="ome.tiff">ome.tiff</option>
            <option value="tiff">tiff</option>
        </param>
        <param name="channel_csv" type="data" format="csv" label="Channel Metadata CSV"/>
    </inputs>

    <outputs>
        <data name="renamed_image" format="ome.tiff" label="${tool.name} on ${on_string}">
            <change_format>
                <when input="input_type" value="ome.tiff" format="ome.tiff" />
                <when input="input_type" value="tiff" format="tiff" />
            </change_format>
        </data>
    </outputs>
    <tests>
        <test>
            <param name="image" value="test.tiff" />
            <param name="input_type" value="tiff" />
            <param name="channel_csv" value="channels.csv" />
            <output name="renamed_image" ftype="tiff">
                <assert_contents>
                    <has_size value="177000" delta="10000" />
                </assert_contents>
            </output>
        </test>
    </tests>
    
    <help><![CDATA[
    ]]></help>
    <expand macro="citations" />
</tool>
