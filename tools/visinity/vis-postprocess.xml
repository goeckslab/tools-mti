<tool id="visinity_postprocess" name="Visualize Visinity Archive" tool_type="interactive" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="22.01">
    <description>Visualize pre-processed Visinity archives</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="stdio"/>
    <expand macro="version_cmd"/>
    <entry_points>
        <entry_point name="Visualize Visinity Archive" requires_domain="True">
            <port>8000</port>
            <url>/</url>
        </entry_point>
    </entry_points>
    <command detect_errors="aggressive">
        <![CDATA[
    cp working/inputs.json /visinity/ &&
    cp "$__tool_directory__/archive_ingest.py" /visinity/archive_ingest.py &&
    cd /visinity/ &&
    CONDAFY="micromamba run /bin/bash -c" &&
    \$CONDAFY "python archive_ingest.py inputs.json" &&
    \$CONDAFY "python run.py";
        ]]>
    </command>
    <configfiles>
	    <inputs name='inputs' filename='inputs.json' data_style='paths'/>
    </configfiles>
    <inputs>
        <param label='Visinity Archive' name='vis_archive' type='data' format='zip' help="Output of Create Visinity Archive tool"/>
        <param label='Registered Images' name='channel_files' type='data_collection' collection_type='list' format='ome.tiff' help="Collection of properly formatted OME-TIFF images (Example: output of ASHLAR)"/>
        <param label='Segmentation Masks' name='label_files' type='data_collection' collection_type='list' format='tiff' help="Collection of masks (tiff) as generated by cell/nuclear segmentation tool (Mesmer, S3segmenter, etc.)"/>
    </inputs>
    <outputs>
        <data name="output" format="txt"/>
    </outputs>
    <tests>
    </tests>
    <help><![CDATA[
**Visualize a Visinity Archive**

Running Visinity in Galaxy requires execution of two separate tools in succession:

1. Create Visinity Archive 
2. Visualize Visinity Archive (**this tool**)

**Archive visualizer inputs**

1. **Visinity Archive**        Output of *Create Visinity Archive* (Tool 1)
2. **Registered Images**       Same *Registered Images* collection used for Tool 1 (Collection of properly formatted OME-TIFF images (Example: output of ASHLAR))
3. **Segmentation Masks**      Same *Segmentation Masks* collection used for Tool 1 (Collection of masks (tiff) as generated by cell/nuclear segmentation tool (Mesmer, S3segmenter, etc.))

**~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~**

**IMPORTANT NOTE**

**Registered image and segmentation mask collections must be the same collections used for archive building!**

**~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~**
   
**Outputs**

This is an interactive tool. Once the tool is running (turns orange in the history panel), 
view the Visinity dashboard by navigating to User > Active InteractiveTools

Once the Visinity dashboard is launched, see the Visinity publication (https://doi.org/10.1109%2FTVCG.2022.3209378) for navigating Visinity and conducting analyses. 
    ]]>
    </help>
    <expand macro="citations" />
</tool>
